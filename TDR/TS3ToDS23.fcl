// Andrei Gaponenko, 2013

#include "minimalMessageService.fcl"
#include "standardProducers.fcl"
#include "standardServices.fcl"

# Give this job a name.
process_name : TS3ToDS23

source : { module_type : RootInput }

services : {

    message               : @local::default_message
    TFileService          : { fileName : "histTS3ToDS23.root" }
    RandomNumberGenerator : { }

    user : {
        GeometryService        : { inputFile      : "JobConfig/TDR/geom_TS3ToDS23.txt" }
        ConditionsService      : { conditionsfile : "Mu2eG4/test/conditions_01.txt"      }
        GlobalConstantsService : { inputFile      : "Mu2eG4/test/globalConstants_01.txt" }
        G4Helper               : { }
        SeedService            : @local::automaticSeeds
    }
}

physics : {
    producers: {

        g4run : {
            module_type          : G4
            inputSimParticles : "g4filter:s0"
            simParticleNumberOffset : 100000 // safe b/c of g4.particlesSizeLimit in stage1

            generatorModuleLabel : ""
            genInputHits : [ "g4filter:TS3Vacuum" ]

            doWriteLegacyPhysVolumeInfo : false
            inputPhysVolumeMultiInfoLabel : "g4run"

            SDConfig : {
                enableSD : [ virtualdetector, CRV ] // activate just the explicitly listed SDs
                sensitiveVolumes: [ DS2Vacuum, DS3Vacuum ]
            }

            SimParticlePrinter : {
                enabled : false
                primariesOnly : false
                prefix : "SimParticle: "
            }
        }
    }

    filters: {
        g4filter: {
            module_type: FilterG4Out
            mainHitInputs : [ "g4run:DS2Vacuum", "g4run:DS3Vacuum", "g4run:CRV" ]
            extraHitInputs : [ "g4run:virtualdetector" ]
            numSimParticleCollections : 1
            vetoDaughters: []
        }
        g4status: {
            module_type: FilterStatusG4
            input: "g4run"
        }
    }

    trigFilter : [g4run, g4filter]
    g4StatusFilter : [g4run, g4status ]
    trigger_paths  : [trigFilter, g4StatusFilter]

    //e1 : [filteredOutput, filteredEvtsOutput, fullOutput]
    e1 : [filteredOutput, truncatedEvtsOutput]
    end_paths      : [e1]
}

outputs: {
    filteredOutput : {
        module_type : RootOutput
        outputCommands:   [ "keep *_*_*_*", "drop *_g4run_*_*", "drop *_*_*_BeamPrimaryToTS3DS23", "keep mu2e::StatusG4_*_*_*", "keep mu2e::GenParticles_*_*_*", "keep uintmu2e::PhysicalVolumeInfomvstd::pairs_g4run_*_TS3ToDS23" ]
        fileName    : "dataTS3ToDS23.root"
    }

    filteredEvtsOutput : {
        module_type : RootOutput
        SelectEvents: { SelectEvents: [trigFilter] }
        outputCommands:   [ "keep *_*_*_*", "drop *_g4run_*_*", "drop *_*_*_BeamPrimaryToTS3DS23", "keep mu2e::StatusG4_*_*_*", "keep uintmu2e::PhysicalVolumeInfomvstd::pairs_g4run_*_TS3ToDS23" ]
        fileName    : "dataTS3ToDS23_fe.root"
    }

    truncatedEvtsOutput : {
        module_type : RootOutput
        SelectEvents: { SelectEvents: ["!g4StatusFilter"] }
        outputCommands:   [ "keep *_*_*_*", "drop *_g4filter_*_TS3ToDS23", "drop *_*_*_BeamPrimaryToTS3DS23", "keep mu2e::StatusG4_*_*_*", "keep mu2e::GenParticles_*_*_*"]
        fileName    : "truncatedTS3ToDS23.root"
    }

    fullOutput : {
        module_type : RootOutput
        fileName    : "dataTS3ToDS23_full.root"
    }
}

// Initialze seeding of random engines: do not put these lines in base .fcl files for grid jobs.
services.user.SeedService.baseSeed         :  0
services.user.SeedService.maxUniqueEngines :  20
